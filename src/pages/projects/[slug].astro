---
import type { GetStaticPaths, MDXInstance } from "astro";
import Layout from "../../layouts/Layout.astro";
import Link from "../../components/Link.astro";
import { Card } from "../../components/Card.tsx";

type Frontmatter = {
  title: string;
  description: string;
  slug: string;
  needsJS: boolean;
};

export const getStaticPaths = (async () => {
  const projects: MDXInstance<Frontmatter>[] = await Astro.glob<Frontmatter>(
    "../../projects/**/*.mdx"
  );

  const projectsMap = projects.map((project) => ({
    params: {
      slug: project.frontmatter.slug,
    },
    props: {
      project,
    },
  }));

  return projectsMap;
}) satisfies GetStaticPaths;

const { Content, frontmatter } = Astro.props.project;
---

<Layout title={`projects - ${frontmatter.title}`}>
  <Link href="/projects">⬅️ back</Link>
  {
    frontmatter.needsJS && (
      <noscript>
        <Card type="error">you need javascript fo this, please enable it and try again</Card>
      </noscript>
    )
  }
  <h1 class="text-4xl" transition:name={`${frontmatter.title}-title`}>
    {frontmatter.title}
  </h1>
  <p>{frontmatter.description}</p>
  <Content />
</Layout>
